<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>íƒˆë˜ë§ë˜ íŒŒíŠ¸ë„ˆìŠ¤ - ë¡œê·¸ì¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;900&display=swap");

        body {
            font-family: "Pretendard", sans-serif;
            background-color: #0f172a;
            /* Slate 900 */
            color: white;
            -webkit-tap-highlight-color: transparent;
        }

        /* ì…ë ¥ì°½ í¬ì»¤ìŠ¤ ì‹œ ì•„ì´ì½˜ ìƒ‰ìƒ ë³€ê²½ ì• ë‹ˆë©”ì´ì…˜ */
        .input-group:focus-within i {
            color: #818cf8;
            transform: scale(1.1);
        }

        .input-group:focus-within {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        /* ë²„íŠ¼ í´ë¦­ íš¨ê³¼ */
        .btn-press:active {
            transform: scale(0.98);
        }
    </style>
</head>

<body class="h-[100dvh] w-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">

    <div
        class="absolute top-[-10%] left-[-20%] w-80 h-80 bg-indigo-600/30 rounded-full blur-[100px] pointer-events-none">
    </div>
    <div
        class="absolute bottom-[-10%] right-[-20%] w-80 h-80 bg-rose-500/20 rounded-full blur-[100px] pointer-events-none">
    </div>

    <div class="w-full max-w-sm z-10">

        <div class="text-center mb-10">
            <div
                class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl shadow-indigo-500/30">
                <i data-lucide="car-front" class="w-10 h-10 text-white"></i>
            </div>
            <h1 class="text-3xl font-black mb-2 tracking-tight">ê¸°ì‚¬ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!</h1>
            <p class="text-slate-400">ì˜¤ëŠ˜ë„ ì•ˆì „ìš´í–‰ í•˜ì„¸ìš” ğŸš—</p>
        </div>

        <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-5">

            <div class="space-y-1">
                <label class="text-xs font-bold text-slate-400 ml-1 uppercase tracking-wider">Driver ID</label>
                <div
                    class="input-group flex items-center bg-slate-800/80 border border-slate-700 rounded-2xl px-4 py-3.5 transition-all duration-300">
                    <i data-lucide="user" class="w-5 h-5 text-slate-500 transition-colors mr-3"></i>
                    <input type="text" id="driverId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        class="bg-transparent border-none outline-none text-white placeholder-slate-500 w-full font-medium"
                        value="driver_jake" required>
                </div>
            </div>

            <div class="space-y-1">
                <label class="text-xs font-bold text-slate-400 ml-1 uppercase tracking-wider">Password</label>
                <div
                    class="input-group flex items-center bg-slate-800/80 border border-slate-700 rounded-2xl px-4 py-3.5 transition-all duration-300">
                    <i data-lucide="lock" class="w-5 h-5 text-slate-500 transition-colors mr-3"></i>
                    <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸"
                        class="bg-transparent border-none outline-none text-white placeholder-slate-500 w-full font-medium">
                </div>
            </div>

            <div class="flex items-center justify-between px-1">
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="checkbox"
                        class="w-4 h-4 rounded border-slate-600 bg-slate-800 text-indigo-500 focus:ring-indigo-500/50">
                    <span class="text-sm text-slate-400">ìë™ ë¡œê·¸ì¸</span>
                </label>
                <a href="#" class="text-sm text-indigo-400 font-bold hover:text-indigo-300">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
            </div>

            <button type="submit" id="loginBtn"
                class="w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-2xl font-bold text-lg shadow-lg shadow-indigo-500/40 btn-press transition-all flex justify-center items-center gap-2 mt-4">
                <span>ìš´í–‰ ì‹œì‘í•˜ê¸°</span>
                <i data-lucide="arrow-right" class="w-5 h-5"></i>
            </button>

        </form>

        <p class="text-center text-slate-500 text-sm mt-8">
            ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="#"
                class="text-white font-bold underline decoration-indigo-500 decoration-2 underline-offset-4">íŒŒíŠ¸ë„ˆ
                ì§€ì›í•˜ê¸°</a>
        </p>
    </div>

    <script>
        lucide.createIcons();
        // ì†Œì¼“ ì´ˆê¸°í™”
        const socket = io();

        // ì„œë²„ì— "ë‚˜ ê¸°ì‚¬ë‹˜ì…ë‹ˆë‹¤"ë¼ê³  ì•Œë¦¼
        socket.emit('join_driver');

        // [í•µì‹¬] ì„œë²„ë¡œë¶€í„° 'receive_call' ì´ë²¤íŠ¸ë¥¼ ë°›ìœ¼ë©´ ì‹¤í–‰
        socket.on('receive_call', (data) => {
            console.log("ì½œ ë°›ìŒ:", data);

            // 1. ëª¨ë‹¬ ë‚´ìš© ì—…ë°ì´íŠ¸ (ìŠ¹ê°ì´ ë³´ë‚¸ ì •ë³´ë¡œ ë®ì–´ì“°ê¸°)
            updateModalContent(data);

            // 2. ì•Œë¦¼ ì†Œë¦¬ ì¬ìƒ (ì„ íƒì‚¬í•­)
            // new Audio('ringtone.mp3').play();

            // 3. ëª¨ë‹¬ ë„ìš°ê¸° (ê¸°ì¡´ í•¨ìˆ˜ í™œìš©)
            triggerCall();
        });

        // ë°›ì€ ë°ì´í„°ë¡œ ëª¨ë‹¬ ë‚´ìš©ì„ ë™ì ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
        function updateModalContent(data) {
            const modal = document.getElementById('call-modal');

            // ì•ˆì „í•˜ê²Œ ìš”ì†Œ ì°¾ê¸° ë° í…ìŠ¤íŠ¸ ë³€ê²½
            // (ì£¼ì˜: HTML ìš”ì†Œì— í•´ë‹¹ IDë‚˜ í´ë˜ìŠ¤ê°€ ì •í™•í•´ì•¼ í•©ë‹ˆë‹¤. ì—¬ê¸°ì„  ì˜ˆì‹œë¡œ querySelector ì‚¬ìš©)

            // ì¶œë°œì§€ (í° ê¸€ì”¨)
            const pickupTitle = modal.querySelector('h3:nth-of-type(1)');
            if (pickupTitle) pickupTitle.innerText = data.pickup;

            // ë„ì°©ì§€ (íšŒìƒ‰ ê¸€ì”¨)
            const destTitle = modal.querySelector('h3:nth-of-type(2)');
            if (destTitle) destTitle.innerText = data.destination;

            // ì˜ˆìƒ ìˆ˜ì…
            const priceTag = modal.querySelector('.bg-indigo-50');
            if (priceTag) priceTag.innerText = `ì˜ˆìƒ ìˆ˜ì… ${parseInt(data.price).toLocaleString()}ì›`;
        }

        function handleLogin(e) {
            e.preventDefault(); // í¼ ì œì¶œ ì‹œ ìƒˆë¡œê³ ì¹¨ ë°©ì§€

            const driverIdInput = document.getElementById('driverId').value;
            const btn = document.getElementById('loginBtn');

            // 1. ìœ íš¨ì„± ê²€ì‚¬ (ê°„ë‹¨íˆ)
            if (!driverIdInput) {
                alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            // 2. ë¡œë”© íš¨ê³¼ (UX)
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i> ë¡œê·¸ì¸ ì¤‘...`;
            lucide.createIcons();

            // 3. ì‹¤ì œ ë¡œê·¸ì¸ ì²˜ë¦¬ (ì—¬ê¸°ì„œëŠ” localStorage ì €ì¥ í›„ í˜ì´ì§€ ì´ë™)
            setTimeout(() => {
                // [ì¤‘ìš”] ê¸°ì‚¬ IDë¥¼ ì €ì¥í•´ì„œ main.htmlì—ì„œ ì“¸ ìˆ˜ ìˆê²Œ í•¨
                localStorage.setItem('tm_driver_id', driverIdInput);

                // í˜ì´ì§€ ì´ë™
                window.location.href = './driverPage.html'; // íŒŒì¼ëª…ì´ main.htmlì´ì–´ì•¼ í•©ë‹ˆë‹¤.
            }, 1000); // 1ì´ˆ ë”œë ˆì´ ì£¼ëŠ” ì²™ (ë©‹ì„ ìœ„í•´)
        }
    </script>
</body>

</html>